# BiliTraceC - Bç«™å¼¹å¹•æº¯æºå·¥å…·

ğŸ” åŸºäºCRC32é€†å‘å·¥ç¨‹çš„é«˜æ€§èƒ½Cè¯­è¨€å¼¹å¹•å‘é€è€…UIDè¿½è¸ªå·¥å…·

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Language: C](https://img.shields.io/badge/Language-C-blue.svg)](https://en.wikipedia.org/wiki/C_(programming_language))

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- **å®æ—¶å¼¹å¹•æŠ“å–**ï¼šæ— éœ€ç™»å½•ï¼Œè§£æå½“å‰å¼¹å¹•æ± 
- **å†å²å¼¹å¹•å›æº¯**ï¼šçªç ´7å¤©é™åˆ¶ï¼Œå¯è¿½æº¯è‡³è§†é¢‘å‘å¸ƒæ—¥æœŸçš„å…¨é‡å¼¹å¹•
- **æ™ºèƒ½å»é‡**ï¼šè‡ªåŠ¨è¿‡æ»¤é‡å¤å¼¹å¹•ï¼Œé¿å…å†—ä½™è¾“å‡º
- **å…³é”®è¯æœç´¢**ï¼šç²¾ç¡®åŒ¹é…åŒ…å«ç‰¹å®šæ–‡æœ¬çš„å¼¹å¹•
- **å•ç»“æœæ¨¡å¼**ï¼šæ‰¾åˆ°ç¬¬ä¸€æ¡åŒ¹é…å³åœæ­¢ (`-first`)
- **ç¦»çº¿Hashç ´è§£**ï¼šç›´æ¥è¾“å…¥CRC32 Hashè¿›è¡ŒUIDåæŸ¥
- **é«˜æ€§èƒ½ä¼˜åŒ–**ï¼šæŸ¥è¡¨æ³•CRC32 + å¤šçº¿ç¨‹ï¼Œååé‡å¯è¾¾ 500M Hash/s

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### ç¼–è¯‘ (Windows MinGW)

```bash
gcc -O3 -Wall -pthread -I./deps/curl-8.11.1_1-win64-mingw/include \
    -L./deps/curl-8.11.1_1-win64-mingw/lib \
    -o check_history.exe main.c cracker.c network.c proto_parser.c history_api.c cJSON.c \
    -lcurl -lws2_32
```

### ä½¿ç”¨ç¤ºä¾‹

```bash
# 1. å®æ—¶æ¨¡å¼ï¼ˆæ— éœ€ç™»å½•ï¼‰
./check_history -cid 497529158 -search "å…³é”®è¯"

# 2. å†å²å›æº¯æ¨¡å¼ï¼ˆéœ€SESSDATAï¼Œçªç ´7å¤©é™åˆ¶ï¼‰
./check_history -cid 497529158 -sessdata "YOUR_SESSDATA" -search "å…³é”®è¯"

# 3. å•ç»“æœæ¨¡å¼ï¼ˆæ‰¾åˆ°ç¬¬ä¸€ä¸ªå°±åœï¼Œæ¨èæ—¥å¸¸ä½¿ç”¨ï¼‰
./check_history -cid 497529158 -sessdata "xxx" -search "å…³é”®è¯" -first

# 4. ç²¾ç¡®å›æº¯ï¼ˆæŒ‡å®šBVIDï¼Œè‡ªåŠ¨è¯†åˆ«è§†é¢‘å‘å¸ƒæ—¥æœŸä½œä¸ºå›æº¯ç»ˆç‚¹ï¼‰
./check_history -cid 497529158 -bvid BV1xx411xxxx -sessdata "xxx" -search "å…³é”®è¯" -first

# 5. ç¦»çº¿Hashç ´è§£
./check_history -hash c0f262d1
```

## ğŸ“‹ å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `-cid <CID>` | è§†é¢‘å†…å®¹ID (å¿…éœ€) | `-cid 497529158` |
| `-sessdata <COOKIE>` | ç™»å½•å‡­è¯ï¼Œç”¨äºå†å²æ¨¡å¼ | `-sessdata "xxx..."` |
| `-search <å…³é”®è¯>` | æœç´¢åŒ…å«å…³é”®è¯çš„å¼¹å¹• | `-search "å‰æ–¹é«˜èƒ½"` |
| `-first` | å•ç»“æœæ¨¡å¼ï¼Œæ‰¾åˆ°å³åœ | `-first` |
| `-bvid <BVID>` | è§†é¢‘BVå·ï¼Œç”¨äºè‡ªåŠ¨è·å–å‘å¸ƒæ—¥æœŸ | `-bvid BV1GM411M7Ue` |
| `-hash <HASH>` | ç¦»çº¿ç ´è§£CRC32å“ˆå¸Œ | `-hash bc28c067` |
| `-threads <N>` | å¹¶è¡Œçº¿ç¨‹æ•° (1-64) | `-threads 16` |

## ğŸ”¬ æŠ€æœ¯åŸç†

Bç«™å¼¹å¹•çš„ `midHash` å­—æ®µæ˜¯ç”¨æˆ·UIDçš„CRC32å“ˆå¸Œå€¼ã€‚ç”±äºï¼š

1. CRC32æ˜¯æ ¡éªŒç®—æ³•è€ŒéåŠ å¯†ç®—æ³•
2. UIDä¸ºé€’å¢æ•´æ•°ï¼Œç©ºé—´æœ‰é™ï¼ˆ~40äº¿ï¼‰
3. ç°ä»£CPUç®—åŠ›å¼ºå¤§

å› æ­¤å¯é€šè¿‡æš´åŠ›éå†åœ¨æ•°ç§’å†…è¿˜åŸçœŸå®UIDã€‚

### å†å²å›æº¯åŸç†

Bç«™é‡‡ç”¨å†·çƒ­æ•°æ®åˆ†ç¦»æ¶æ„ï¼š

- **çƒ­æ•°æ®**ï¼šæœ€è¿‘7å¤©ï¼Œé€šè¿‡é»˜è®¤APIå¿«é€Ÿè®¿é—®
- **å†·æ•°æ®**ï¼šå†å²å…¨é‡ï¼Œéœ€é€šè¿‡ `history/index` + `history/seg.so` ä¸“ç”¨æ¥å£

æœ¬å·¥å…·å®ç°äº† **æ—¥å†çˆ¬å–ç®—æ³• (Calendar Crawl)**ï¼Œè‡ªåŠ¨éå†æ¯æœˆç´¢å¼•å¹¶æå–å†å²å¼¹å¹•ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
BiliTraceC/
â”œâ”€â”€ main.c              # ä¸»ç¨‹åºï¼ˆå‚æ•°è§£æã€æ¨¡å¼è°ƒåº¦ã€å›è°ƒå¤„ç†ï¼‰
â”œâ”€â”€ cracker.c/h         # CRC32æš´åŠ›ç ´è§£æ¨¡å—
â”œâ”€â”€ network.c/h         # HTTPç½‘ç»œå°è£… (libcurl)
â”œâ”€â”€ history_api.c/h     # å†å²å¼¹å¹•APIï¼ˆç´¢å¼•è·å–ã€åˆ†ç‰‡ä¸‹è½½ï¼‰
â”œâ”€â”€ proto_parser.c/h    # Protobufæ‰‹åŠ¨è§£æå™¨
â”œâ”€â”€ crc32_core.h        # CRC32æ ¸å¿ƒç®—æ³•ï¼ˆæŸ¥è¡¨æ³•ï¼‰
â”œâ”€â”€ utils.h             # å·¥å…·å‡½æ•°ï¼ˆå¿«é€Ÿæ•´æ•°è½¬å­—ç¬¦ä¸²ï¼‰
â”œâ”€â”€ cJSON.c/h           # JSONè§£æåº“
â”œâ”€â”€ Makefile            # Linux/macOSç¼–è¯‘é…ç½®
â”œâ”€â”€ build.bat/sh        # Windows/Linuxç¼–è¯‘è„šæœ¬
â”œâ”€â”€ CMakeLists.txt      # CMakeé…ç½®
â”œâ”€â”€ deps/               # ä¾èµ–åº“ï¼ˆéœ€è‡ªè¡Œä¸‹è½½curlï¼‰
â”œâ”€â”€ .gitignore          # Gitå¿½ç•¥è§„åˆ™
â””â”€â”€ README.md           # æœ¬æ–‡ä»¶
```

## ğŸ“Š æ€§èƒ½æ•°æ®

| CPU | å•çº¿ç¨‹ | 8çº¿ç¨‹ | å…¨ç©ºé—´æ‰«æ |
|-----|--------|-------|-----------|
| Intel i7-9700K | 65 M/s | 480 M/s | ~8.3ç§’ |
| AMD R7-5800X | 75 M/s | 560 M/s | ~7.1ç§’ |

> å®é™…ç ´è§£æ—¶é—´å–å†³äºç›®æ ‡UIDå¤§å°ï¼Œå¹³å‡å‘½ä¸­æ—¶é—´çº¦ä¸ºå…¨æ‰«æçš„ä¸€åŠ

## ğŸ” è·å–SESSDATA

1. ç™»å½• [bilibili.com](https://www.bilibili.com)
2. æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° Application > Cookies
4. å¤åˆ¶ `SESSDATA` çš„å€¼

> âš ï¸ è¯·ä½¿ç”¨æµ‹è¯•è´¦å·ï¼Œé«˜é¢‘è®¿é—®å¯èƒ½è§¦å‘é£æ§



## âš ï¸ å…è´£å£°æ˜

**æœ¬å·¥å…·ä»…ä¾›å®‰å…¨ç ”ç©¶ä¸å­¦æœ¯äº¤æµä½¿ç”¨**

- è¯·å‹¿ç”¨äºç½‘ç»œæš´åŠ›ã€äººè‚‰æœç´¢ç­‰éæ³•è¡Œä¸º
- å¤§è§„æ¨¡çˆ¬å–å¯èƒ½è¿åBç«™æœåŠ¡æ¡æ¬¾
- ä½¿ç”¨æœ¬å·¥å…·äº§ç”Ÿçš„æ³•å¾‹åæœç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…
- æŠ€æœ¯æœ¬èº«æ˜¯ä¸­æ€§çš„ï¼Œä½¿ç”¨è€…å¿…é¡»éµå®ˆæ³•å¾‹ä¸é“å¾·åº•çº¿

## ğŸ“œ è®¸å¯è¯

[MIT License](LICENSE)

## ğŸ”— å‚è€ƒèµ„æ–™

- [CRC32ç®—æ³•è¯¦è§£](https://create.stephan-brumme.com/crc32/)
- [Bç«™å¼¹å¹•åè®®åˆ†æ](https://socialsisteryi.github.io/bilibili-API-collect/)
- [libcurlæ–‡æ¡£](https://curl.se/libcurl/)
